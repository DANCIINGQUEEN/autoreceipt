# 📑 요구사항 명세서 (최종)

## 1. 📸 영수증 업로드 및 분석

| 항목        | 설명                                                         |
| ----------- | ------------------------------------------------------------ |
| 입력 데이터 | 사용자가 업로드한 이미지(영수증 사진)                        |
| 처리 방식   | Tesseract.js로 OCR → GPT API로 구조화된 데이터 추출          |
| 분석 항목   | 결제일자, 이름, 목적 및 내용, 퇴근시간, 금액, 음식점 여부 등 |
| 사용 기술   | Tesseract.js, OpenAI GPT (`response_format: zod`)            |

---

## 2. 🧠 GPT 분석 구조

| 필드명           | 설명                                         |
| ---------------- | -------------------------------------------- |
| `date`           | 영수증의 결제일자 (YYYY-MM-DD)               |
| `name`           | 사용자 이름 (UI에서 `prompt()`로 입력 받음)  |
| `purpose`        | 목적 및 내용. 음식점이면 자동으로 `야근식대` |
| `leave_time`     | 자동 생성 (19:30~22:00 사이, 30분 단위 랜덤) |
| `limited_amount` | 금액 제한 로직 적용된 값 (아래 참고)         |
| `is_fnb`         | 음식점 여부 (지도 API + 텍스트 기반 추론)    |

---

## 3. 💰 금액 제한 정책

| 항목                  | 설명                                        |
| --------------------- | ------------------------------------------- |
| 음식점 (F&B)          | 금액이 10,000원 초과 시 → 10,000원으로 제한 |
| 교통비, 도서구입비 등 | 제한 없음 (원래 금액 그대로)                |

---

## 4. 🗺️ 음식점 판단

| 방식                 | 설명                                                             |
| -------------------- | ---------------------------------------------------------------- |
| 1차 필터링           | GPT 분석 결과 텍스트에 음식 관련 키워드 포함 시 판단             |
| 2차 판단 (선택 적용) | 주소, 사업자번호로 Kakao/Naver 지도 API 조회 후 음식점 여부 확인 |

---

## 5. 📝 수정 가능한 분석 결과 UI

| 기능     | 설명                                                             |
| -------- | ---------------------------------------------------------------- |
| 인풋 UI  | 분석된 각 항목을 input 필드로 보여주고 사용자가 수정 가능        |
| 반응형   | 모바일에서도 한 줄에 하나씩 잘 정렬되도록 Tailwind 적용          |
| 자동입력 | `is_fnb`가 true인 경우 `목적 및 내용` 필드에 `야근식대` 자동입력 |

---

## 6. 🔍 이미지 확대 기능

| 기능        | 설명                                           |
| ----------- | ---------------------------------------------- |
| 썸네일 클릭 | 이미지 클릭 시 모달 열림                       |
| 확대 보기   | 모달 중앙에 큰 이미지 표시, 하단에 '닫기' 버튼 |
| ESC 키 동작 | 키보드 ESC로도 모달 닫기 가능                  |

---

## 7. 📤 서버 전송 및 엑셀 생성

| 항목         | 설명                                                  |
| ------------ | ----------------------------------------------------- |
| 전송 방식    | `FormData`: JSON metadata + 이미지 파일들 함께 POST   |
| 정렬 기준    | 결제일자 오름차순 정렬 후 전송                        |
| FastAPI 처리 | Python + openpyxl로 템플릿 엑셀에 이미지 및 내용 삽입 |

---

## 8. 📄 엑셀 템플릿 구성 (`assets/receipt_final.xlsx`)

| 규칙        | 상세 설명                                                |
| ----------- | -------------------------------------------------------- |
| 시트당 최대 | 4개 영수증 입력                                          |
| 이미지 위치 | A4:B17, C4:D17, A23:B36, C23:D36                         |
| 데이터 셀   | B18~22, D18~22, B37~41, D37~41                           |
| 시트 개수   | 필요한 만큼 자동으로 복사 생성 (`Sheet1`, `Sheet2`, ...) |
| 이미지 크기 | 셀 안에 꽉 차도록 사이즈 조절 (비율 유지)                |

---

## 9. 🔐 기타 고려사항

- ❗ 파일명 중복 방지 처리 (분석 시 유일한 이름 유지)
- ✅ Excel 서식 보존을 위해 프론트에서 엑셀 처리 금지
- ✅ 백엔드에서만 엑셀 템플릿을 보유 및 수정
- ✅ CORS 정책 허용 (localhost:3000 ↔ localhost:8000 통신 허용)

---

## 📌 향후 개선 방향 (제안)

| 항목                      | 설명                                       |
| ------------------------- | ------------------------------------------ |
| 사용자의 사유 직접 입력   | UI에서 목적 선택 가능하게 하기             |
| 업로드 파일 히스토리 저장 | 최근 업로드된 영수증 목록 관리             |
| 서버 상태 알림            | 백엔드 에러 발생 시 프론트에서 메시지 표시 |
